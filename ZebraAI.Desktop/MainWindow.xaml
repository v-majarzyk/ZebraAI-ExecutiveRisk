<Window x:Class="ZebraAI.Desktop.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Zebra Exec-Risk Scanner (Mock)"
        Height="680" Width="1250"
        WindowStartupLocation="CenterScreen">

  <DockPanel Margin="12">

    <!-- Top toolbar -->
    <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,0,0,8">
      <ToggleButton x:Name="SapFilterToggle"
                    Content="Filter SAP"
                    IsChecked="{Binding IsSapFilterOpen}"
                    Margin="0,0,8,0"/>
      <CheckBox Content="Show only 'Engage Now'"
                IsChecked="{Binding ShowOnlyEngageNow}"
                Margin="0,0,12,0"
                VerticalAlignment="Center"/>
      <Button Content="Run"
              Command="{Binding RunCommand}"
              Width="120"
              Margin="0,0,8,0"/>
      <Button Content="Export CSV"
              Command="{Binding ExportCsvCommand}"
              Width="120"/>
    </StackPanel>

    <!-- Main area: left filter panel, draggable splitter, right grid -->
    <Grid>
      <Grid.ColumnDefinitions>
        <!-- Left panel starts hidden; widths toggled in code-behind -->
        <ColumnDefinition x:Name="LeftCol" Width="0"/>
        <!-- Splitter column: Auto when open, 0 when closed -->
        <ColumnDefinition x:Name="SplitterCol" Width="0"/>
        <ColumnDefinition Width="*"/>
      </Grid.ColumnDefinitions>

      <!-- Left: SAP filter panel (shown only when IsSapFilterOpen toggles columns open) -->
      <Expander Grid.Column="0"
                Header="SAP Filter"
                IsExpanded="{Binding IsSapFilterOpen}"
                VerticalAlignment="Stretch">
        <Grid>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>  <!-- controls row -->
            <RowDefinition Height="*"/>     <!-- list area -->
          </Grid.RowDefinitions>

          <!-- Controls row -->
          <StackPanel Orientation="Horizontal" Grid.Row="0" Margin="0,0,0,6">
            <TextBox Width="220"
                     ToolTip="Search SAP names"
                     Text="{Binding SapFilterSearch, UpdateSourceTrigger=PropertyChanged}"/>
            <Button Content="All"  Margin="8,0,0,0" Command="{Binding SapSelectAllCmd}"/>
            <Button Content="None" Margin="4,0,0,0" Command="{Binding SapSelectNoneCmd}"/>
          </StackPanel>

          <!-- List fills remaining space; scroll when needed -->
          <Border Grid.Row="1" BorderBrush="#DDD" BorderThickness="1">
            <ListBox ItemsSource="{Binding SapItemsView}"
                     Padding="4"
                     BorderThickness="0"
                     VerticalAlignment="Stretch"
                     VerticalContentAlignment="Top"
                     ScrollViewer.VerticalScrollBarVisibility="Auto"
                     ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                     VirtualizingPanel.IsVirtualizing="True"
                     VirtualizingPanel.ScrollUnit="Pixel">
              <ListBox.ItemsPanel>
                <ItemsPanelTemplate>
                  <VirtualizingStackPanel/>
                </ItemsPanelTemplate>
              </ListBox.ItemsPanel>
              <ListBox.ItemTemplate>
                <DataTemplate>
                  <CheckBox Content="{Binding Name}"
                            IsChecked="{Binding IsSelected, Mode=TwoWay}"/>
                </DataTemplate>
              </ListBox.ItemTemplate>
            </ListBox>
          </Border>
        </Grid>
      </Expander>

      <!-- Draggable splitter between left and right -->
      <GridSplitter x:Name="ColSplitter"
                    Grid.Column="1"
                    Width="6"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch"
                    ResizeBehavior="PreviousAndNext"
                    ResizeDirection="Columns"
                    ShowsPreview="True"
                    Background="#EEE"
                    Cursor="SizeWE"/>

      <!-- Right: results grid fills all remaining space and scrolls horizontally if needed -->
      <DataGrid Grid.Column="2"
                x:Name="ResultsGrid"
                ItemsSource="{Binding ResultsView}"
                AutoGenerateColumns="False"
                CanUserAddRows="False"
                CanUserReorderColumns="True"
                CanUserResizeColumns="True"
                IsReadOnly="True"
                ScrollViewer.VerticalScrollBarVisibility="Auto"
                ScrollViewer.HorizontalScrollBarVisibility="Auto"
                EnableColumnVirtualization="True"
                EnableRowVirtualization="True">
        <DataGrid.Columns>
          <DataGridTextColumn Header="Case" Binding="{Binding CaseNumber}" Width="110"/>
          <DataGridTextColumn Header="SAP" Binding="{Binding Sap}" Width="200"/>
          <DataGridTextColumn Header="Title" Binding="{Binding Title}" Width="220"/>
          <DataGridCheckBoxColumn Header="Engage Now" Binding="{Binding EngageNow}" Width="110"/>
          <DataGridTextColumn Header="Customer" Binding="{Binding Customer}" Width="140"/>
          <DataGridTextColumn Header="Severity" Binding="{Binding Severity}" Width="80"/>
          <DataGridTextColumn Header="Days Open" Binding="{Binding DaysOpen}" Width="90"/>
          <DataGridTextColumn Header="Reason" Binding="{Binding Reason}" Width="220"/>
          <DataGridTextColumn Header="Last Eng Update (UTC)" Binding="{Binding LastEngineerUpdateUtc}" Width="170" />
          <DataGridTextColumn Header="Last Dissatisfaction...(UTC)" Binding="{Binding LastDissatisfactionUtc}" Width="190" />
          <DataGridTextColumn Header="Last Contact (UTC)" Binding="{Binding LastContact}" Width="110" />
          <!-- Fixed wide column to enable H-scroll when narrow -->
          <DataGridTextColumn Header="Summary" Binding="{Binding Summary}" Width="600" MinWidth="400" />
          <DataGridTextColumn Header="Link" Binding="{Binding Link}" Width="200"/>
        </DataGrid.Columns>
      </DataGrid>
    </Grid>
  </DockPanel>
</Window>
